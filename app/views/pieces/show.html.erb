<% set_meta(
    :keywords => @piece.tag_list,
    :description => @piece.description,
    :og => {:type => "website",
            :description => @piece.description,
            :image => @piece.image.url(:square), 
            :title => @piece.title,
            :description => @piece.description,

            }, 
:twitter => {
      :card => "photo",
      :site => "@#{@piece.user.profile.twitter}",
      :image => {
              :url => @piece.image.url(:square)
            },
      :title => @piece.title,
      :description => @piece.description,
      :image =>  @piece.image.url(:square),
      :url => user_piece_path(:id => @piece.id, :user_slug => @piece.user.profile.slug)
            
    }
    ) 
%>



<div>
<br/>
<p class="pull-right">
  <% unless current_user == nil %>
  <% if  UserFav.where(:user_id => current_user.id, :piece_id => @piece.id).exists? %>
          <%= link_to raw("<i class='glyphicon glyphicon-heart-empty'></i>  Un-Favourite"), delete_user_favs_path(:user_fav => {:piece_id => @piece.id, :user_id => current_user.id}), :remote => true, class: "btn btn-sm fav btn-info pull-right", :method => :delete %>
      <% else %>
        <%= link_to raw("<i class='glyphicon glyphicon-heart'></i>  Favourite"), user_favs_path(:user_fav => {:piece_id => @piece.id,:user_id => current_user.id}), :remote => true, class: "btn btn-sm fav btn-info pull-right", :method => :post %>
  <% end %>
   <% end %>
</p>
<h2>
  <%= truncate(@piece.title.capitalize, :length => 50) %><br/>
  <small class="pull-left">by <%= link_to @piece.user.profile.display_name || @piece.user.name, vanity_url_path(@piece.user.profile) %></small>
  <span class="pull-left">
  <%#= render 'follow_form', :html => {class:  "pull-right"} %>
  </span>
</h2  >
  <br/>
  <hr/>
</div>

<div class="clearfix">
  <div class="text-center">
  <%= image_tag @piece.image.url(), :class => "img-responsive pull-center"%>
  </div>
  <hr/>
  <div class="col-md-8">
     <label class="label label-primary">
      <i class="glyphicon glyphicon-eye-open white"></i>
      <%= @piece.views.to_i %> Views
    </label> 
    &nbsp;
    <label class="label label-info">
      <i class="glyphicon glyphicon-heart"></i>
      <%= @piece.favourited_by.count %> Favourites
    </label> 
    &nbsp;
    <% @piece.tag_list.each do |tag| %>
      <label class="label label-default">
        <i class="glyphicon glyphicon-tag white"></i>
      <%= link_to tag, tagged_pieces_path(:tag => tag) %>
    </label> &nbsp;
    <% end %> 
    <% if @piece.sold %>
      <label class="label label-danger white" >Sold</label>
    <% end %>
    <br/><br/>
     <p class="well">
      <%= auto_link(@piece.description, :html => { :target => '_blank' }) %>
    </p>
    <p>
      <strong>Dimensions:</strong>
      <%= @piece.dimensions %>
    </p>

  </div>
  <div class="col-md-4">
   
    <!-- <div class="panel panel-default">
        <div class="panel-heading "><h5 class=""> Dope or Nope?</h5></div>
        <div class="panel-body">

              <%#= link_to raw("<i class='glyphicon glyphicon-thumbs-up'></i>  Dope (#{@piece.get_likes.size})"), dope_path(:id => @piece.id), :remote => true, class: "btn fav btn-sm btn-success", :method => :post %>

                  <%#= link_to raw("<i class='glyphicon glyphicon-thumbs-down'></i>  Nope (#{@piece.get_dislikes.size})"), nope_path(:id => @piece.id), :remote => true, class: "btn btn-sm fav btn-danger", :method => :post %>        
        </div>
        </div> -->

        <% unless @piece.sold == true || @piece.price.to_i <= 0 %>
        <div class="panel panel-primary">
          <div class="panel-heading "><h5 class="white"><i class='white glyphicon glyphicon-shopping-cart'></i> Buy "<%= truncate(@piece.title, :length => 20) %>"</h5></div>
          <div class="panel-body">
            <p>$<%= @piece.price.to_i %></p>
              <%= form_tag charges_path do %>

              <%= hidden_field_tag :amount, number_with_precision(@piece.price, :precision => 2), :class=> "form-control", :width => "50%", :min => number_with_precision(@piece.price, :precision => 2), :step => 1 %>

              <%= hidden_field_tag :id, @piece.id %>

              <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                      data-key="<%= @piece.user.stripe_publishable_key %>"
                      data-description="<%= @piece.title %>" data-email="<%#= current_user.email %>"
                      data-image="<%= @piece.image.url(:small) %>"
                      data-amount="<%= @piece.price.to_i*100 %>"></script>
            <% end %>
          
        </div>
        </div>
        <% end %>
        <div class="panel panel-default">
        <div class="panel-heading "><h5 class=""><i class='glyphicon glyphicon-share-alt'></i> Share</h5></div>
        <div class="panel-body">
          <%= tweet_button(via: "artupio", url: "#{piece_url(@piece)}", text: "Nice #art '#{@piece.title} by #{@piece.user.profile.display_name}' :", count: "none") %>
          <%#= like_button(app_id) %>
          <%= pinit_button %>
          <%= google_plus_button %>
          <input value="<%= short_url(@piece) %>" cols="100"
          />
          
        </div>
        </div>

    <% unless @piece.favourited_by == [] %>
      <div class="panel panel-info">
        <div class="panel-heading "><h5 class="white"><i class='glyphicon glyphicon-heart'></i> Favourited By</h5></div>
        <div class="panel-body">
          <% @piece.favourited_by.limit(10).each do |user| %>
            <%= link_to(image_tag(user.profile.image.url(:thumb), :class => "img-circle"), vanity_url_path( :id => user.profile.slug)) %>
          <% end %>
        </div>
    <% end %>
    </div>
    </div>

    <br/><br/>
    <% if current_user && current_user.admin? %>
      <%= link_to 'Edit', edit_piece_path(@piece), :class => "pull-right" %>
    <% end %>
         
  </div>

</div>



<hr/>

<br/>
<br/>
